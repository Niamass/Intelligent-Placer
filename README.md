# Intelligent-Placer
 
### Описание программы 
По поданной на вход фотографии нескольких предметов на светлой горизонтальной поверхности и многоугольнику определяется, можно ли расположить одновременно все эти предметы на плоскости так, чтобы они влезли в этот многоугольник. Предметы и горизонтальная поверхность, которые могут оказаться на фотографии, заранее известны. Также заранее известно направление вертикальной оси Z у этих предметов.

### Вход 
Фотография в формате jpg, на которой находятся:
  + предметы, лежащие на светлой горионтальной поверхности;
  + многоугольник, нарисованный темным маркером на белом листе бумаги А4.

### Выход 
Ответ в текстовом формате, записанный в файл answer_<имя входной фотографии>.txt:
  + "Yes" - предметы можно поместить в многоугольник;
  + "No" - предметы нельзя поместить в многоугольник.

### Требования к входным данным 
 #### Многоугольник
  + Число вершин многоугольника не более 10;
  + Многоугольник нарисован на чистом белом листе формата А4;
  + Толщина линии многоугольника не более 5 мм.
  + Края листа с многоугольником хорошо видны на поверхности;
  + Лист с многоугольником целиком находится внутри фотографии.
 #### Фон
  + Поверхность, на которой располагаются лист и предметы, гладкая, однородная;
  + Для всех фотографий используется одна и та же поверхность.
 #### Предметы
  + Предметы подобраны так, чтобы их гарницы четко выделялись на фоне белого листа бумаги;
  + Предметы располагаются рядом с листом, на котором нарисован многоугольник, не касаясь и не пересекая лист;
  + Предметы не касаются и не перекрывают друг друга;
  + Выбранные предметы целиком находятся внутри фотографии;
  + На фотографии отсутствуют предметы помимо тех, что представлены.
 #### Фотография
  + Разрешение фотографии не менее 1280x720 px;
  + Фотография сделана сверху, камера при фотографировании удерживается параллельно поверхности с предметами;
  + Отсутствие на фотографии пересвеченных и серо-черных областей;
  + Отсутствие размытости фотографии: толщина линий границ предметов не более 10px;
  + Отсутствие черных теней, занимающих большую площадь, чем четверть площади предмета;
  + Отсутствие сжатия и цветовой коррекции.


### План решения задачи
1. Нахождение объектов на эталонных фотографиях - фотографиях объектов на фоне листа:(сделано)  
  1.1 Наложение фильтров на изображение;  
  1.2 Поиск контуров на изображении с фильтрами;  
  1.3 Излечение контура, вложенного в максимальный контур (контур листа);  
  1.4 Определение границ прямоугольника, описывающего предмет, и получение его вырезки из общего изображения.  
2. Нахождение многоугольника на тестовой фотографии:(сделано)  
  2.1 - 2.2 повторяют пункты 1.1 - 1.2  
3. Нахождение объектов на тестовой фотографии:(сделано)  
  3.1 - 3.2 повторяют пункты 1.1 - 1.2  
  3.3 Из контуров, вложенных в максимальный, удаляются малые по площади контуры;  
  3.4 повторяет пункт 1.4 
4. Идентификация объектов:(сделано)  
  (На первой итерации:  
  4.1 Поиск некоторых объектов по основным цветам (определяемым с помощью кластеризации);  
  4.2 Если объект не был идентифицирован по цветам, проводится поиск по особым точкам.  )
  4.1 Проверка по цвету на предмет №0, если он найден, то переход к идентификации следующего объекта;  
  4.2 Сравнение объектов по особым точкам, получение списка 5 предметов с лучшими совпадениями, отсортированного в порядке уменьшения совпадений;  
  4.3 Сравнение объектов по геометрическим признакам (соотношение высоты и ширины, площадь предмета по отношению к площади ограничивающего предмет прямоугольника), получение списка всех совпадений;  
  4.4 Сравнение списков из пунктов 4.2 и 4.3, составление списка общих предметов. Если их несколько - выбираем первый элемент списка (он лучше всего совпал по особым точкам), если таких нет - выбираем первый предмет из тех, что найдены по геометрическим признакам (как правило, в таких случаях находится только один предмет).  
5. Размещение в многоугольнике:(сделано) 
  5.1 Сортировка контуров найденных объектов в порядке убывания радиуса описанной окружности;  
  5.2 Проверка на очевидную невозможность размещения: возвращаем ответ False, если площадь предметов или радиус описанной окружности какого-либо предмета больше, чем у многоугольника;  
  5.3 Для каждого предмета производится обход многоугольника по сетке с некоторым шагом: в каждой точке сетки ищется подходящий для размещения угол и с помощью битовой маски проверяется, не вышел ли предмет за границы многоугольника.  


### Оценка результатов
####1 итерация
  1. Многоугольник хорошо распознается на всех тестовых изображениях;  
  2. Предметы находятся и выделяются на всех тестовых изображениях, на эталонных фотографиях контуры определяются чуть точнее, чем на тестовых;  
  3. Идентификация по особым точкам хорошо определяла примерно 50% предметов на входных тестах, при добавлении идентификации по цветам неверно идентифицируются предметы на тестовых изображениях 6, 7, 10: путаются друг с другом предметы №2 и №8, №2 и №7(у них есть близкие цветовые оттенки), №1 и №5, №4 и №5. Выделение основных цветов работает меделенно.  

####2 итерация
  1. Изменен способ вырезания изображения предмета из общего изображения - стало учитываться отклонение предмета от горизонатльного положения, что позволило изменить идентификацию предметов, так как высота и ширина контуров стали определяться точнее;  
  2. Вместо идентификации по основным цветам используется идентификация по геометрическим признакам, отдельно добавлен поиск по цвету для предмета №0, так как особые точки находятся плохо, а по геометрии он может быть перепутан с другим круглым предметом №8. Результат: верная идентификация на всех тестах;  
  3. Добавлено размещение предметов в многоугольнике. На всех тестах можно получить верный ответ, но для некоторых для этого требуется сильное измельчение сетки (это относится к тестам №2 и №4, так как для  кисточки значительно ограничено число успешных местоположений). Также, так как решение переборное, программа работает медленно.  

  Возможное улучшение: после идентификации для размещения брать преобразованные контуры с изображений эталонных объектов, а не найденные на тестовых изображениях, так как на тестовых изображениях граница может искажаться. Также можно улучшить движение по многоугольнику при переборе, исключая шаги в заведомо неоптимальную сторону.  

### Предметы и набор входных данных 
https://drive.google.com/drive/folders/1otjPC2E9D-RCKn3Exzy6z-gG98K22GPm?usp=sharing

